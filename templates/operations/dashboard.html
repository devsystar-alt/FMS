{% extends "layout.html" %}

{% block title %}لوحة تحكم مناوب العمليات{% endblock %}

{% block content %}
<div class="operations-dashboard">
    <!-- رأس الصفحة -->
    <div class="dashboard-header">
        <div class="header-info">
            <h1><i class="fas fa-tasks"></i> لوحة تحكم مناوب العمليات</h1>
            <p>مرحباً {{ session.user_name }} | الوحدة: {{ current_unit.name if current_unit else 'غير محدد' }}</p>
            <div class="unit-stats">
                <span class="stat-item">
                    <i class="fas fa-gas-pump"></i>
                    <strong>{{ unit_stats.total_operations }}</strong> عمليات
                </span>
                <span class="stat-item">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <strong>{{ unit_stats.dispensed_operations }}</strong> منصرف
                </span>
                <span class="stat-item">
                    <i class="fas fa-file-excel"></i>
                    <strong>{{ unit_stats.non_dispensed_operations }}</strong> غير منصرف
                </span>
            </div>
        </div>
        <div class="header-actions">
            <button class="btn btn-primary" onclick="showAddOperationForm()">
                <i class="fas fa-plus-circle"></i> إضافة عملية جديدة
            </button>
            <button class="btn btn-secondary" onclick="refreshData()">
                <i class="fas fa-sync-alt"></i> تحديث
            </button>
        </div>
    </div>

    <!-- إحصائيات سريعة -->
    <div class="quick-stats">
        <div class="stat-card">
            <div class="stat-icon success">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number">{{ today_stats.today_operations }}</div>
                <div class="stat-label">عمليات اليوم</div>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon warning">
                <i class="fas fa-clock"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number">{{ today_stats.pending_operations }}</div>
                <div class="stat-label">قيد الانتظار</div>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon petrol">
                <i class="fas fa-fire"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number">{{ "%.1f"|format(today_stats.today_petrol) }}</div>
                <div class="stat-label">لتر بترول اليوم</div>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon diesel">
                <i class="fas fa-oil-can"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number">{{ "%.1f"|format(today_stats.today_diesel) }}</div>
                <div class="stat-label">لتر ديزل اليوم</div>
            </div>
        </div>
    </div>

    <!-- 1. السجلات غير المنصرفة (في الأعلى) -->
    <div class="section-header">
        <h2><i class="fas fa-clock text-warning"></i> السجلات غير المنصرفة (قيد الانتظار)</h2>
        <div class="section-tools">
            <div class="search-box">
                <input type="text" id="searchPending" placeholder="ابحث في السجلات..." 
                       class="form-control" onkeyup="filterOperations()">
                <i class="fas fa-search"></i>
            </div>
            <select id="filterDispenseType" class="form-select" onchange="filterOperations()">
                <option value="">جميع أنواع الصرف</option>
                {% for type in dispense_types %}
                <option value="{{ type.id }}">{{ type.name }}</option>
                {% endfor %}
            </select>
        </div>
    </div>
    
    <div class="table-container pending-table">
        <table class="table" id="pendingOperationsTable">
            <thead>
                <tr>
                    <th>#</th>
                    <th>رقم السند</th>
                    <th>التاريخ</th>
                    <th>الوحدة</th>
                    <th>السائق</th>
                    <th>المركبة</th>
                    <th>الوقود</th>
                    <th>الكمية</th>
                    <th>نوع الصرف</th>
                    <th>الغرض</th>
                    <th>الملاحظات</th>
                    <th>تاريخ الإضافة</th>
                    <th>الإجراءات</th>
                </tr>
            </thead>
            <tbody>
                {% for op in all_operations if op.receipt_status_id == 2 %}
                <tr class="pending-operation" data-dispense="{{ op.dispense_type_id }}" data-search="{{ op.driver_name|lower }} {{ op.vehicle_type|lower }} {{ op.receipt_number }} {{ op.unit_name|lower if op.unit_name else '' }}">
                    <td>{{ loop.index }}</td>
                    <td>
                        <strong class="receipt-number pending">#{{ op.receipt_number }}</strong>
                    </td>
                    <td>{{ op.operation_date }}</td>
                    <td>
                        <span class="unit-badge">{{ op.unit_name if op.unit_name else 'غير محدد' }}</span>
                    </td>
                    <td>{{ op.driver_name }}</td>
                    <td>
                        <span class="vehicle-badge">{{ op.vehicle_type }}</span>
                    </td>
                    <td>
                        {% if op.petrol_quantity > 0 and op.diesel_quantity > 0 %}
                        <div class="fuel-badges">
                            <span class="badge petrol">بترول</span>
                            <span class="badge diesel">ديزل</span>
                        </div>
                        {% elif op.petrol_quantity > 0 %}
                        <span class="badge petrol">بترول</span>
                        {% else %}
                        <span class="badge diesel">ديزل</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if op.petrol_quantity > 0 %}
                        <div class="quantity petrol">{{ "%.2f"|format(op.petrol_quantity) }} لتر</div>
                        {% endif %}
                        {% if op.diesel_quantity > 0 %}
                        <div class="quantity diesel">{{ "%.2f"|format(op.diesel_quantity) }} لتر</div>
                        {% endif %}
                    </td>
                    <td>
                        {% if op.dispense_name == 'مخصص' %}
                        <span class="dispense-type custom">
                            <i class="fas fa-user-cog"></i> {{ op.dispense_name }}
                        </span>
                        {% elif op.dispense_name == 'بلاغ' %}
                        <span class="dispense-type report">
                            <i class="fas fa-file-alt"></i> {{ op.dispense_name }}
                        </span>
                        {% elif op.dispense_name == 'أوامر' %}
                        <span class="dispense-type orders">
                            <i class="fas fa-file-signature"></i> {{ op.dispense_name }}
                        </span>
                        {% else %}
                        <span class="dispense-type">
                            {{ op.dispense_name }}
                        </span>
                        {% endif %}
                    </td>
                    <td>
                        {% if op.purpose %}
                        <span class="purpose-text" title="{{ op.purpose }}">
                            {{ op.purpose[:20] }}{% if op.purpose|length > 20 %}...{% endif %}
                        </span>
                        {% else %}
                        <span class="text-muted">لا يوجد</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if op.notes %}
                        <div class="notes-preview" onclick="showNotes('{{ op.notes|escapejs }}')">
                            {{ op.notes[:20] }}{% if op.notes|length > 20 %}...{% endif %}
                        </div>
                        {% else %}
                        <span class="text-muted">لا توجد</span>
                        {% endif %}
                    </td>
                    <td>
                        <small>{{ op.created_at[:10] }}</small>
                        <br>
                        <small class="text-muted">{{ op.created_at[11:16] }}</small>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-warning" 
                                    onclick="editOperation({{ op.id }})"
                                    title="تعديل العملية">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" 
                                    onclick="deleteOperation({{ op.id }})"
                                    title="حذف العملية">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="13" class="text-center">
                        <div class="empty-state">
                            <i class="fas fa-clock fa-2x text-warning"></i>
                            <h4>لا توجد سجلات غير منصرفة</h4>
                            <p>جميع السجلات تم صرفها أو قم بإضافة سجلات جديدة</p>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- 2. السجلات المنصرفة (في الأسفل) -->
    <div class="section-header">
        <h2><i class="fas fa-check-circle text-success"></i> السجلات المنصرفة (تم التأكيد)</h2>
        <div class="section-tools">
            <div class="date-filter">
                <label>من:</label>
                <input type="date" id="fromDate" class="form-control" value="{{ today }}">
                <label>إلى:</label>
                <input type="date" id="toDate" class="form-control" value="{{ today }}">
                <button class="btn btn-sm btn-primary" onclick="filterDispensed()">
                    <i class="fas fa-filter"></i> تصفية
                </button>
            </div>
        </div>
    </div>
    
    <div class="table-container dispensed-table">
        <table class="table" id="dispensedOperationsTable">
            <thead>
                <tr>
                    <th>#</th>
                    <th>رقم السند</th>
                    <th>تاريخ العملية</th>
                    <th>تاريخ الصرف</th>
                    <th>الوحدة</th>
                    <th>السائق</th>
                    <th>المركبة</th>
                    <th>الكمية المصروفة</th>
                    <th>تم الصرف بواسطة</th>
                    <th>وقت الصرف</th>
                    <th>ملاحظات الصرف</th>
                    <th>الإجراءات</th>
                </tr>
            </thead>
            <tbody>
                {% for op in dispensed_operations %}
                <tr class="dispensed-operation">
                    <td>{{ loop.index }}</td>
                    <td>
                        <strong class="receipt-number dispensed">#{{ op.receipt_number }}</strong>
                        <span class="badge success">تم الصرف</span>
                    </td>
                    <td>{{ op.operation_date }}</td>
                    <td>{{ op.dispensed_at[:10] if op.dispensed_at else 'غير معروف' }}</td>
                    <td>
                        <span class="unit-badge">{{ op.unit_name if op.unit_name else 'غير محدد' }}</span>
                    </td>
                    <td>{{ op.driver_name }}</td>
                    <td>
                        <span class="vehicle-badge">{{ op.vehicle_type }}</span>
                    </td>
                    <td>
                        {% if op.petrol_quantity > 0 %}
                        <div class="quantity petrol">
                            <i class="fas fa-fire"></i>
                            {{ "%.2f"|format(op.petrol_quantity) }} لتر
                        </div>
                        {% endif %}
                        {% if op.diesel_quantity > 0 %}
                        <div class="quantity diesel">
                            <i class="fas fa-oil-can"></i>
                            {{ "%.2f"|format(op.diesel_quantity) }} لتر
                        </div>
                        {% endif %}
                    </td>
                    <td>
                        <div class="dispensed-by">
                            <i class="fas fa-user-check"></i>
                            {{ op.dispensed_by if op.dispensed_by else 'مناوب بالمحروقات' }}
                        </div>
                    </td>
                    <td>
                        <div class="timestamp">
                            <i class="fas fa-clock"></i>
                            {{ op.dispensed_at[11:16] if op.dispensed_at else 'غير معروف' }}
                        </div>
                    </td>
                    <td>
                        {% if op.dispense_notes %}
                        <div class="notes-preview" onclick="showDispenseNotes('{{ op.dispense_notes|escapejs }}')">
                            {{ op.dispense_notes[:20] }}{% if op.dispense_notes|length > 20 %}...{% endif %}
                        </div>
                        {% else %}
                        <span class="text-muted">لا توجد ملاحظات</span>
                        {% endif %}
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-info" onclick="viewOperationDetails({{ op.id }})">
                                <i class="fas fa-eye"></i> عرض
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="printReceipt({{ op.id }})">
                                <i class="fas fa-print"></i> طباعة
                            </button>
                        </div>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="12" class="text-center">
                        <div class="empty-state">
                            <i class="fas fa-check-circle fa-2x text-success"></i>
                            <h4>لا توجد سجلات منصرفة</h4>
                            <p>السجلات التي يتم صرفها ستظهر هنا</p>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- نموذج إضافة عملية جديدة -->
    <div id="addOperationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-plus-circle"></i> إضافة عملية جديدة</h3>
                <button class="modal-close" onclick="closeAddModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addOperationForm" onsubmit="return submitOperationForm(event)">
                    <!-- التاريخ ورقم السند -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="operation_date">تاريخ العملية *</label>
                            <input type="date" id="operation_date" name="operation_date" 
                                   class="form-control" required 
                                   value="{{ today }}">
                        </div>
                        <div class="form-group">
                            <label for="receipt_number">رقم السند *</label>
                            <div class="receipt-input-group">
                                <input type="number" id="receipt_number" name="receipt_number" 
                                       class="form-control" required 
                                       placeholder="أدخل رقم السند"
                                       min="{{ max_receipt_number + 1 }}"
                                       value="{{ max_receipt_number + 1 }}">
                                <div class="input-hint">
                                    <small>آخر رقم سند: <span id="lastReceiptNumber">{{ max_receipt_number }}</span></small>
                                    <small>المقترح التالي: <span id="nextReceiptNumber">{{ max_receipt_number + 1 }}</span></small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- بيانات السائق والمركبة -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="driver_name">اسم السائق (على السند) *</label>
                            <input type="text" id="driver_name" name="driver_name" 
                                   class="form-control" required 
                                   placeholder="أدخل اسم السائق كما هو على السند">
                        </div>
                        <div class="form-group">
                            <label for="vehicle_type">نوع المركبة *</label>
                            <select id="vehicle_type" name="vehicle_type" class="form-control" required>
                                <option value="">اختر نوع المركبة</option>
                                <option value="طقم">طقم</option>
                                <option value="لاندكروزر">لاندكروزر</option>
                                <option value="هايلكس">هايلكس</option>
                                <option value="باص">باص</option>
                                <option value="طقم نيسان">طقم نيسان</option>
                                <option value="جيب">جيب</option>
                                <option value="عربة إسعاف">عربة إسعاف</option>
                                <option value="عربة اتصالات">عربة اتصالات</option>
                                <option value="دراجة نارية">دراجة نارية</option>
                                <option value="أخرى">أخرى</option>
                            </select>
                            <input type="text" id="vehicle_other" name="vehicle_other" 
                                   class="form-control mt-2" 
                                   placeholder="حدد نوع المركبة الأخرى"
                                   style="display: none;">
                        </div>
                    </div>

                    <!-- نوع الصرف والوحدة -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="dispense_type">نوع الصرف *</label>
                            <select id="dispense_type" name="dispense_type_id" class="form-control" required
                                    onchange="togglePurposeField()">
                                <option value="">اختر نوع الصرف</option>
                                <option value="1">مخصص</option>
                                <option value="2">بلاغ</option>
                            </select>
                        </div>
                        <div class="form-group" id="unitField">
                            <label for="unit_id">الوحدة *</label>
                            <select id="unit_id" name="unit_id" class="form-control" required>
                                <option value="">اختر الوحدة</option>
                                <option value="1">خارج المخصص</option>  <!-- قيمة افتراضية -->
                                {% for unit in units %}
                                {% if unit.name != 'خارج المخصص' %}
                                <option value="{{ unit.id }}">{{ unit.name }}</option>
                                {% endif %}
                                {% endfor %}
                            </select>
                            <small class="text-muted">اختر "خارج المخصص" إذا لم تكن العملية تابعة لوحدة محددة</small>
                        </div>
                    </div>

                    <!-- الغرض -->
                    <div class="form-group" id="purposeField" style="display: none;">
                        <label for="purpose">الغرض *</label>
                        <input type="text" id="purpose" name="purpose" class="form-control"
                               placeholder="أدخل الغرض من الصرف">
                    </div>

                    <!-- نوع وكمية الوقود -->
                    <div class="form-group">
                        <label>نوع وكمية الوقود *</label>
                        <div class="fuel-inputs">
                            <div class="fuel-input">
                                <label for="petrol_quantity">
                                    <i class="fas fa-fire petrol-icon"></i> كمية البترول (لتر)
                                </label>
                                <input type="number" id="petrol_quantity" name="petrol_quantity" 
                                       class="form-control" min="0" step="0.01" 
                                       placeholder="0.00" value="0">
                            </div>
                            <div class="fuel-input">
                                <label for="diesel_quantity">
                                    <i class="fas fa-oil-can diesel-icon"></i> كمية الديزل (لتر)
                                </label>
                                <input type="number" id="diesel_quantity" name="diesel_quantity" 
                                       class="form-control" min="0" step="0.01" 
                                       placeholder="0.00" value="0">
                            </div>
                        </div>
                        <div class="form-error" id="fuelError"></div>
                    </div>

                    <!-- الملاحظات -->
                    <div class="form-group">
                        <label for="notes">ملاحظات إضافية</label>
                        <textarea id="notes" name="notes" class="form-control" 
                                  rows="3" placeholder="أدخل أي ملاحظات إضافية..."></textarea>
                    </div>

                    <!-- معلومات تلقائية -->
                    <div class="auto-info">
                        <p><i class="fas fa-info-circle"></i> معلومات النظام:</p>
                        <div class="auto-info-grid">
                            <div class="auto-info-item">
                                <span class="auto-label">الشهر:</span>
                                <span class="auto-value" id="autoMonth">{{ current_month }}</span>
                            </div>
                            <div class="auto-info-item">
                                <span class="auto-label">حالة السند:</span>
                                <span class="auto-value text-warning">غير منصرف</span>
                            </div>
                            <div class="auto-info-item">
                                <span class="auto-label">المدخل:</span>
                                <span class="auto-value">{{ session.user_name }}</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeAddModal()">إلغاء</button>
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            <i class="fas fa-save"></i> حفظ العملية
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- مودال عرض الملاحظات -->
    <div id="notesModal" class="modal">
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h3><i class="fas fa-sticky-note"></i> الملاحظات</h3>
                <button class="modal-close" onclick="closeNotesModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="notes-content" id="notesContent"></div>
            </div>
        </div>
    </div>
</div>

<style>
/* تصميم لوحة تحكم مناوب العمليات */
.operations-dashboard {
    padding: 20px;
    max-width: 1600px;
    margin: 0 auto;
}

.dashboard-header {
    background: linear-gradient(135deg, #2c3e50 0%, #27ae60 100%);
    color: white;
    padding: 25px;
    border-radius: 15px;
    margin-bottom: 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
}

.header-info h1 {
    margin: 0 0 10px 0;
    font-size: 1.8rem;
}

.header-info p {
    margin: 0 0 15px 0;
    opacity: 0.9;
}

.unit-stats {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
}

.stat-item {
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(255, 255, 255, 0.1);
    padding: 8px 15px;
    border-radius: 20px;
    cursor: pointer;
    transition: background 0.3s;
}

.stat-item:hover {
    background: rgba(255, 255, 255, 0.2);
}

.stat-item i {
    color: #2ecc71;
}

.header-actions {
    display: flex;
    gap: 10px;
}

/* الإحصائيات السريعة */
.quick-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 20px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    transition: all 0.3s;
    cursor: pointer;
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.stat-icon {
    width: 60px;
    height: 60px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
}

.stat-icon.success {
    background: rgba(46, 204, 113, 0.1);
    color: #27ae60;
}

.stat-icon.warning {
    background: rgba(243, 156, 18, 0.1);
    color: #f39c12;
}

.stat-icon.petrol {
    background: rgba(231, 76, 60, 0.1);
    color: #e74c3c;
}

.stat-icon.diesel {
    background: rgba(52, 152, 219, 0.1);
    color: #3498db;
}

.stat-content .stat-number {
    font-size: 1.8rem;
    font-weight: bold;
    color: #2c3e50;
    margin-bottom: 5px;
}

.stat-content .stat-label {
    color: #666;
    font-size: 0.9rem;
}

/* ترويسة الأقسام */
.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 40px 0 20px 0;
    padding-bottom: 15px;
    border-bottom: 2px solid #eee;
}

.section-header h2 {
    color: #2c3e50;
    font-size: 1.4rem;
    margin: 0;
}

.section-header h2 i {
    margin-left: 10px;
}

.section-tools {
    display: flex;
    gap: 15px;
    align-items: center;
}

.search-box {
    position: relative;
    width: 250px;
}

.search-box input {
    padding-right: 40px;
}

.search-box i {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: #666;
}

.date-filter {
    display: flex;
    align-items: center;
    gap: 10px;
}

.date-filter label {
    font-weight: bold;
    color: #555;
    font-size: 0.9rem;
}

/* الجداول */
.table-container {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    margin-bottom: 40px;
    border: 2px solid transparent;
}

.pending-table {
    border-color: #ff9800;
}

.dispensed-table {
    border-color: #4caf50;
}

.table {
    width: 100%;
    border-collapse: collapse;
}

.table th {
    background: #f8f9fa;
    padding: 15px;
    text-align: right;
    font-weight: bold;
    color: #2c3e50;
    border-bottom: 2px solid #dee2e6;
}

.table td {
    padding: 12px 15px;
    border-bottom: 1px solid #eee;
    vertical-align: middle;
}

.table tr:hover {
    background: #f8f9fa;
}

/* عناصر الجدول */
.receipt-number {
    font-size: 1.1rem;
    font-weight: bold;
    display: inline-block;
    padding: 4px 8px;
    border-radius: 6px;
    margin-right: 5px;
}

.receipt-number.pending {
    background: rgba(255, 152, 0, 0.1);
    color: #f39c12;
    border: 1px solid rgba(255, 152, 0, 0.3);
}

.receipt-number.dispensed {
    background: rgba(76, 175, 80, 0.1);
    color: #27ae60;
    border: 1px solid rgba(76, 175, 80, 0.3);
}

.unit-badge {
    background: #e3f2fd;
    color: #1565c0;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 0.85rem;
    font-weight: 500;
    border: 1px solid #bbdefb;
}

.vehicle-badge {
    background: #f5f5f5;
    color: #616161;
    padding: 5px 12px;
    border-radius: 15px;
    font-size: 0.9rem;
    border: 1px solid #e0e0e0;
}

.fuel-badges {
    display: flex;
    gap: 5px;
}

.badge {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: bold;
    margin: 2px;
}

.badge.success {
    background: rgba(46, 204, 113, 0.1);
    color: #27ae60;
    border: 1px solid rgba(46, 204, 113, 0.3);
}

.badge.petrol {
    background: rgba(231, 76, 60, 0.1);
    color: #e74c3c;
    border: 1px solid rgba(231, 76, 60, 0.3);
}

.badge.diesel {
    background: rgba(52, 152, 219, 0.1);
    color: #3498db;
    border: 1px solid rgba(52, 152, 219, 0.3);
}

.quantity {
    padding: 6px 12px;
    border-radius: 8px;
    font-size: 0.9rem;
    font-weight: bold;
    margin: 2px 0;
    display: inline-flex;
    align-items: center;
    gap: 6px;
}

.quantity.petrol {
    background: rgba(231, 76, 60, 0.1);
    color: #e74c3c;
}

.quantity.diesel {
    background: rgba(52, 152, 219, 0.1);
    color: #3498db;
}

.dispense-type {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    border-radius: 15px;
    font-size: 0.85rem;
    font-weight: bold;
}

.dispense-type.custom {
    background: rgba(155, 89, 182, 0.1);
    color: #9b59b6;
    border: 1px solid rgba(155, 89, 182, 0.3);
}

.dispense-type.report {
    background: rgba(52, 152, 219, 0.1);
    color: #3498db;
    border: 1px solid rgba(52, 152, 219, 0.3);
}

.dispense-type.orders {
    background: rgba(46, 204, 113, 0.1);
    color: #27ae60;
    border: 1px solid rgba(46, 204, 113, 0.3);
}

.purpose-text {
    cursor: help;
    color: #555;
    font-size: 0.9rem;
}

.notes-preview {
    cursor: pointer;
    color: #3498db;
    font-size: 0.9rem;
    padding: 4px;
    border-radius: 4px;
    transition: background 0.3s;
    max-width: 150px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.notes-preview:hover {
    background: #f0f8ff;
}

.dispensed-by {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #27ae60;
    font-weight: 500;
}

.timestamp {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #666;
    font-size: 0.9rem;
}

.action-buttons {
    display: flex;
    gap: 5px;
}

.action-buttons .btn-sm {
    padding: 6px 10px;
    font-size: 0.9rem;
    min-width: 36px;
}

/* حالة فارغة */
.empty-state {
    text-align: center;
    padding: 40px 20px;
    color: #777;
}

.empty-state i {
    margin-bottom: 15px;
    opacity: 0.5;
}

.empty-state h4 {
    margin: 10px 0;
    font-weight: normal;
    color: #555;
}

.empty-state p {
    margin: 0;
    font-size: 0.9rem;
}

/* المودالات */
.modal {
    display: none;
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

.modal.active {
    display: flex;
}

.modal-content {
    background: white;
    border-radius: 15px;
    width: 100%;
    max-width: 700px;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    animation: modalSlide 0.3s ease-out;
}

.modal-content.modal-sm {
    max-width: 500px;
}

@keyframes modalSlide {
    from {
        opacity: 0;
        transform: translateY(-30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    border-bottom: 1px solid #eee;
}

.modal-header h3 {
    margin: 0;
    color: #2c3e50;
}

.modal-close {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: #777;
}

.modal-body {
    padding: 20px;
    overflow-y: auto;
    flex: 1;
}

/* نموذج الإضافة */
.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: bold;
    color: #2c3e50;
    font-size: 0.95rem;
}

.form-control {
    width: 100%;
    padding: 12px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 1rem;
    transition: border-color 0.3s;
}

.form-control:focus {
    outline: none;
    border-color: #27ae60;
}

.receipt-input-group {
    position: relative;
}

.input-hint {
    margin-top: 5px;
    font-size: 0.85rem;
    color: #666;
    display: flex;
    justify-content: space-between;
}

.input-hint small {
    display: block;
}

.fuel-inputs {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.fuel-input label {
    display: flex;
    align-items: center;
    gap: 8px;
}

.petrol-icon {
    color: #e74c3c;
}

.diesel-icon {
    color: #3498db;
}

.form-error {
    color: #e74c3c;
    font-size: 0.9rem;
    margin-top: 5px;
    min-height: 20px;
}

.auto-info {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    border-right: 4px solid #27ae60;
}

.auto-info p {
    margin: 0 0 10px 0;
    color: #2c3e50;
    font-weight: bold;
}

.auto-info-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
}

.auto-info-item {
    display: flex;
    flex-direction: column;
}

.auto-label {
    font-size: 0.85rem;
    color: #666;
    margin-bottom: 3px;
}

.auto-value {
    font-weight: 500;
    color: #2c3e50;
}

.form-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    padding-top: 20px;
    border-top: 1px solid #eee;
}

/* تصميم متجاوب */
@media (max-width: 1200px) {
    .form-row, .fuel-inputs, .auto-info-grid {
        grid-template-columns: 1fr;
    }
    
    .table {
        display: block;
        overflow-x: auto;
    }
}

@media (max-width: 992px) {
    .dashboard-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 20px;
    }
    
    .header-actions {
        align-self: flex-end;
    }
    
    .section-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
    }
    
    .section-tools {
        width: 100%;
        flex-direction: column;
        align-items: stretch;
    }
    
    .search-box, .date-filter {
        width: 100%;
    }
    
    .unit-stats {
        flex-direction: column;
        gap: 10px;
    }
}

@media (max-width: 768px) {
    .operations-dashboard {
        padding: 10px;
    }
    
    .quick-stats {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .modal-content {
        margin: 10px;
    }
}

@media (max-width: 576px) {
    .quick-stats {
        grid-template-columns: 1fr;
    }
    
    .action-buttons {
        flex-direction: column;
    }
    
    .action-buttons .btn-sm {
        width: 100%;
        margin-bottom: 5px;
    }
}
</style>

<script>
// بيانات الصفحة
let maxReceiptNumber = {{ max_receipt_number }};
let pendingOperations = {{ all_operations|tojson|safe }};
let dispensedOperations = {{ dispensed_operations|tojson|safe }};

// تهيئة الصفحة
document.addEventListener('DOMContentLoaded', function() {
    // تحديث رقم السند المقترح
    updateReceiptNumber();
    
    // تحديث التاريخ التلقائي
    updateAutoFields();
    
    // إعداد اختيار نوع المركبة
    setupVehicleSelect();
    
    // إعداد اختيار نوع الصرف
    setupDispenseTypeSelect();
    
    // إضافة مستمع الأحداث للبحث والتصفية
    setupFilters();
});

// تحديث رقم السند المقترح
function updateReceiptNumber() {
    const nextNumber = maxReceiptNumber + 1;
    document.getElementById('receipt_number').value = nextNumber;
    document.getElementById('receipt_number').min = nextNumber;
    document.getElementById('lastReceiptNumber').textContent = maxReceiptNumber;
    document.getElementById('nextReceiptNumber').textContent = nextNumber;
}

// تحديث الحقول التلقائية
function updateAutoFields() {
    const dateInput = document.getElementById('operation_date');
    if (dateInput.value) {
        const date = new Date(dateInput.value);
        const month = date.toLocaleDateString('ar-SA', { year: 'numeric', month: 'long' });
        document.getElementById('autoMonth').textContent = month;
    }
}

// إعداد اختيار نوع المركبة
function setupVehicleSelect() {
    const vehicleSelect = document.getElementById('vehicle_type');
    const vehicleOther = document.getElementById('vehicle_other');
    
    vehicleSelect.addEventListener('change', function() {
        if (this.value === 'أخرى') {
            vehicleOther.style.display = 'block';
            vehicleOther.required = true;
        } else {
            vehicleOther.style.display = 'none';
            vehicleOther.required = false;
            vehicleOther.value = '';
        }
    });
}

// إعداد اختيار نوع الصرف
function setupDispenseTypeSelect() {
    const dispenseType = document.getElementById('dispense_type');
    const unitField = document.getElementById('unitField');
    const purposeField = document.getElementById('purposeField');
    const unitSelect = document.getElementById('unit_id');
    const purposeInput = document.getElementById('purpose');
    
    dispenseType.addEventListener('change', function() {
        const value = this.value;
        
        if (value === '1') { // مخصص
            unitField.style.display = 'block';
            unitSelect.required = true;
            purposeField.style.display = 'none';
            purposeInput.required = false;
            purposeInput.value = '';
        } else { // بلاغ، أوامر، مهام، طارئ، تدريب
            unitField.style.display = 'none';
            unitSelect.required = false;
            unitSelect.value = '';
            purposeField.style.display = 'block';
            purposeInput.required = true;
            
            // تعيين نص نائب بناءً على النوع
            const placeholders = {
                '2': 'أدخل تفاصيل البلاغ',
                '3': 'أدخل رقم وتفاصيل الأمر',
                '4': 'أدخل تفاصيل المهمة',
                '5': 'أدخل تفاصيل الحالة الطارئة',
                '6': 'أدخل تفاصيل التدريب'
            };
            purposeInput.placeholder = placeholders[value] || 'أدخل الغرض من الصرف';
        }
    });
}

// إعداد الفلاتر
function setupFilters() {
    const searchInput = document.getElementById('searchPending');
    let searchTimeout;
    
    searchInput.addEventListener('input', function() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
            filterOperations();
        }, 300);
    });
}

// فلترة العمليات
function filterOperations() {
    const searchTerm = document.getElementById('searchPending').value.toLowerCase();
    const dispenseType = document.getElementById('filterDispenseType').value;
    
    const rows = document.querySelectorAll('#pendingOperationsTable tbody tr.pending-operation');
    
    rows.forEach(row => {
        let show = true;
        
        // البحث
        if (searchTerm) {
            const searchText = row.getAttribute('data-search') || '';
            if (!searchText.includes(searchTerm)) {
                show = false;
            }
        }
        
        // فلترة نوع الصرف
        if (dispenseType) {
            const rowDispense = row.getAttribute('data-dispense');
            if (rowDispense !== dispenseType) {
                show = false;
            }
        }
        
        row.style.display = show ? '' : 'none';
    });
}

// فلترة العمليات المنصرفة
function filterDispensed() {
    const fromDate = document.getElementById('fromDate').value;
    const toDate = document.getElementById('toDate').value;
    
    const rows = document.querySelectorAll('#dispensedOperationsTable tbody tr.dispensed-operation');
    
    rows.forEach(row => {
        const dateCell = row.querySelector('td:nth-child(4)');
        const dispensedDate = dateCell.textContent.trim();
        
        if (dispensedDate >= fromDate && dispensedDate <= toDate) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
}

// عرض نموذج الإضافة
function showAddOperationForm() {
    document.getElementById('addOperationModal').classList.add('active');
    document.body.style.overflow = 'hidden';
    // إعادة تعيين القيم الافتراضية
    updateReceiptNumber();
    togglePurposeField();
}

// إغلاق نموذج الإضافة
function closeAddModal() {
    document.getElementById('addOperationModal').classList.remove('active');
    document.body.style.overflow = 'auto';
    document.getElementById('addOperationForm').reset();
    togglePurposeField();
    updateReceiptNumber();
}

// تبديل حقل الغرض حسب نوع الصرف
function togglePurposeField() {
    const dispenseType = document.getElementById('dispense_type');
    const unitField = document.getElementById('unitField');
    const purposeField = document.getElementById('purposeField');
    const purposeInput = document.getElementById('purpose');
    const unitSelect = document.getElementById('unit_id');
    
    if (dispenseType.value === '1') { // مخصص
        unitField.style.display = 'block';
        unitSelect.required = true;
        purposeField.style.display = 'none';
        purposeInput.required = false;
        purposeInput.value = '';
    } else { // أنواع أخرى
        unitField.style.display = 'none';
        unitSelect.required = false;
        unitSelect.value = '';
        purposeField.style.display = 'block';
        purposeInput.required = true;
    }
}

// إرسال نموذج العملية
async function submitOperationForm(event) {
    event.preventDefault();
    
    // التحقق من صحة البيانات
    if (!validateForm()) {
        return false;
    }
    
    // جمع البيانات
    const formData = {
        operation_date: document.getElementById('operation_date').value,
        receipt_number: document.getElementById('receipt_number').value,
        driver_name: document.getElementById('driver_name').value.trim(),
        vehicle_type: document.getElementById('vehicle_type').value === 'أخرى' ? 
                      document.getElementById('vehicle_other').value.trim() : 
                      document.getElementById('vehicle_type').value,
        dispense_type_id: document.getElementById('dispense_type').value,
        unit_id: document.getElementById('unit_id').value || null,
        purpose: document.getElementById('purpose').value.trim() || '',
        petrol_quantity: parseFloat(document.getElementById('petrol_quantity').value) || 0,
        diesel_quantity: parseFloat(document.getElementById('diesel_quantity').value) || 0,
        notes: document.getElementById('notes').value.trim() || '',
        // القيم التلقائية
        receipt_status_id: 2, // غير منصرف افتراضياً
        operation_officer: '', // سيتم تعبئته من قبل المناوب بالمحروقات
        month: document.getElementById('autoMonth').textContent
    };
    
    // التحقق من رقم السند
    if (parseInt(formData.receipt_number) <= maxReceiptNumber) {
        showError('رقم السند يجب أن يكون أكبر من ' + maxReceiptNumber);
        return false;
    }
    
    // إظهار حالة التحميل
    const submitBtn = document.getElementById('submitBtn');
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري الحفظ...';
    submitBtn.disabled = true;
    
    try {
        const response = await fetch('/api/add-operation', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (data.success) {
            showSuccess('تم إضافة العملية بنجاح! رقم السند: ' + data.receipt_number);
            closeAddModal();
            refreshData();
        } else {
            showError(data.message || 'حدث خطأ أثناء إضافة العملية');
        }
    } catch (error) {
        console.error('خطأ في إرسال البيانات:', error);
        showError('تعذر الاتصال بالخادم');
    } finally {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    }
    
    return false;
}

// التحقق من صحة النموذج
function validateForm() {
    let isValid = true;
    
    // التحقق من اسم السائق
    const driverName = document.getElementById('driver_name').value.trim();
    if (!driverName) {
        showFieldError('driver_name', 'اسم السائق مطلوب');
        isValid = false;
    }
    
    // التحقق من نوع المركبة
    const vehicleType = document.getElementById('vehicle_type').value;
    if (!vehicleType) {
        showFieldError('vehicle_type', 'نوع المركبة مطلوب');
        isValid = false;
    }
    if (vehicleType === 'أخرى') {
        const vehicleOther = document.getElementById('vehicle_other').value.trim();
        if (!vehicleOther) {
            showFieldError('vehicle_other', 'يجب تحديد نوع المركبة');
            isValid = false;
        }
    }
    
    // التحقق من نوع الصرف
    const dispenseType = document.getElementById('dispense_type').value;
    if (!dispenseType) {
        showFieldError('dispense_type', 'نوع الصرف مطلوب');
        isValid = false;
    }
    
    // التحقق من الوحدة (للمخصص فقط)
// التحقق من الوحدة (مطلوبة دائمًا)
const unitId = document.getElementById('unit_id').value;
if (!unitId) {
    showFieldError('unit_id', 'الوحدة مطلوبة');
    isValid = false;
}
    
    // التحقق من الغرض (لأنواع الصرف الأخرى)
    if (dispenseType !== '1') {
        const purpose = document.getElementById('purpose').value.trim();
        if (!purpose) {
            showFieldError('purpose', 'الغرض مطلوب');
            isValid = false;
        }
    }
    
    // التحقق من كمية الوقود
    const petrol = parseFloat(document.getElementById('petrol_quantity').value) || 0;
    const diesel = parseFloat(document.getElementById('diesel_quantity').value) || 0;
    const fuelError = document.getElementById('fuelError');
    
    if (petrol === 0 && diesel === 0) {
        fuelError.textContent = 'يجب إدخال كمية بترول أو ديزل';
        isValid = false;
    } else if (petrol < 0 || diesel < 0) {
        fuelError.textContent = 'كمية الوقود يجب أن تكون موجبة';
        isValid = false;
    } else {
        fuelError.textContent = '';
    }
    
    // التحقق من رقم السند
    const receiptNumber = parseInt(document.getElementById('receipt_number').value);
    if (receiptNumber <= maxReceiptNumber) {
        showFieldError('receipt_number', 'رقم السند يجب أن يكون أكبر من ' + maxReceiptNumber);
        isValid = false;
    }
    
    return isValid;
}

// عرض خطأ للحقل
function showFieldError(fieldId, message) {
    const field = document.getElementById(fieldId);
    const errorDiv = field.nextElementSibling?.classList.contains('form-error') ? 
                     field.nextElementSibling : field.parentElement.nextElementSibling;
    
    if (errorDiv && errorDiv.classList.contains('form-error')) {
        errorDiv.textContent = message;
        field.style.borderColor = '#e74c3c';
        
        // إزالة الخطأ عند التصحيح
        const removeError = function() {
            errorDiv.textContent = '';
            field.style.borderColor = '#e0e0e0';
            field.removeEventListener('input', removeError);
        };
        field.addEventListener('input', removeError);
    }
}

// عرض الملاحظات
function showNotes(notes) {
    document.getElementById('notesContent').innerHTML = `
        <div class="notes-text" style="padding: 15px; background: #f8f9fa; border-radius: 8px; line-height: 1.6;">
            ${notes.replace(/\n/g, '<br>')}
        </div>
    `;
    document.getElementById('notesModal').classList.add('active');
}

// عرض ملاحظات الصرف
function showDispenseNotes(notes) {
    document.getElementById('notesContent').innerHTML = `
        <div class="notes-text" style="padding: 15px; background: #f8f9fa; border-radius: 8px; line-height: 1.6;">
            <h5 style="color: #27ae60; margin-bottom: 10px;">ملاحظات الصرف:</h5>
            ${notes.replace(/\n/g, '<br>')}
        </div>
    `;
    document.getElementById('notesModal').classList.add('active');
}

// إغلاق مودال الملاحظات
function closeNotesModal() {
    document.getElementById('notesModal').classList.remove('active');
}

// تعديل العملية
async function editOperation(operationId) {
    try {
        const response = await fetch(`/api/operation/${operationId}`);
        const data = await response.json();
        
        if (data.success) {
            // تعبئة النموذج ببيانات العملية
            const operation = data.operation;
            document.getElementById('operation_date').value = operation.operation_date;
            document.getElementById('receipt_number').value = operation.receipt_number;
            document.getElementById('driver_name').value = operation.driver_name;
            
            // نوع المركبة
            const vehicleType = operation.vehicle_type;
            const vehicleOptions = Array.from(document.getElementById('vehicle_type').options).map(opt => opt.value);
            if (vehicleOptions.includes(vehicleType)) {
                document.getElementById('vehicle_type').value = vehicleType;
            } else {
                document.getElementById('vehicle_type').value = 'أخرى';
                document.getElementById('vehicle_other').style.display = 'block';
                document.getElementById('vehicle_other').value = vehicleType;
            }
            
            // نوع الصرف والوحدة والغرض
            document.getElementById('dispense_type').value = operation.dispense_type_id;
            document.getElementById('unit_id').value = operation.unit_id || '';
            document.getElementById('purpose').value = operation.purpose || '';
            
            // كميات الوقود
            document.getElementById('petrol_quantity').value = operation.petrol_quantity;
            document.getElementById('diesel_quantity').value = operation.diesel_quantity;
            
            // الملاحظات
            document.getElementById('notes').value = operation.notes || '';
            
            // تحديث الحقول التلقائية
            updateAutoFields();
            togglePurposeField();
            
            // تغيير زر الحفظ
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.innerHTML = '<i class="fas fa-save"></i> تحديث العملية';
            submitBtn.onclick = function(e) {
                e.preventDefault();
                updateOperation(operationId);
            };
            
            // عرض النموذج
            showAddOperationForm();
        } else {
            showError('تعذر تحميل بيانات العملية');
        }
    } catch (error) {
        console.error('خطأ في تحميل البيانات:', error);
        showError('تعذر الاتصال بالخادم');
    }
}

// تحديث العملية
async function updateOperation(operationId) {
    // جمع البيانات
    const formData = {
        operation_date: document.getElementById('operation_date').value,
        receipt_number: document.getElementById('receipt_number').value,
        driver_name: document.getElementById('driver_name').value.trim(),
        vehicle_type: document.getElementById('vehicle_type').value === 'أخرى' ? 
                      document.getElementById('vehicle_other').value.trim() : 
                      document.getElementById('vehicle_type').value,
        dispense_type_id: document.getElementById('dispense_type').value,
        unit_id: document.getElementById('unit_id').value || null,
        purpose: document.getElementById('purpose').value.trim() || '',
        petrol_quantity: parseFloat(document.getElementById('petrol_quantity').value) || 0,
        diesel_quantity: parseFloat(document.getElementById('diesel_quantity').value) || 0,
        notes: document.getElementById('notes').value.trim() || '',
        // الحفاظ على نفس الشهر
        month: document.getElementById('autoMonth').textContent
    };
    
    // التحقق من صحة البيانات
    if (!validateForm()) {
        return false;
    }
    
    // إظهار حالة التحميل
    const submitBtn = document.getElementById('submitBtn');
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري التحديث...';
    submitBtn.disabled = true;
    
    try {
        const response = await fetch(`/api/update-operation/${operationId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (data.success) {
            showSuccess('تم تحديث العملية بنجاح!');
            closeAddModal();
            refreshData();
        } else {
            showError(data.message || 'حدث خطأ أثناء تحديث العملية');
        }
    } catch (error) {
        console.error('خطأ في تحديث البيانات:', error);
        showError('تعذر الاتصال بالخادم');
    } finally {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    }
}

// حذف العملية
async function deleteOperation(operationId) {
    if (!confirm('هل أنت متأكد من حذف هذه العملية؟ هذا الإجراء لا يمكن التراجع عنه.')) {
        return;
    }
    
    try {
        const response = await fetch(`/api/delete-operation/${operationId}`, {
            method: 'DELETE'
        });
        
        const data = await response.json();
        
        if (data.success) {
            showSuccess('تم حذف العملية بنجاح');
            refreshData();
        } else {
            showError(data.message || 'تعذر حذف العملية');
        }
    } catch (error) {
        console.error('خطأ في الحذف:', error);
        showError('تعذر الاتصال بالخادم');
    }
}

// عرض تفاصيل العملية
function viewOperationDetails(operationId) {
    window.open(`/operations/receipt/${operationId}`, '_blank');
}

// طباعة السند
function printReceipt(operationId) {
    window.open(`/operations/print/${operationId}`, '_blank');
}

// تحديث البيانات
function refreshData() {
    location.reload();
}

// إظهار رسالة نجاح
function showSuccess(message) {
    alert('✓ ' + message);
}

// إظهار رسالة خطأ
function showError(message) {
    alert('✗ ' + message);
}
</script>
{% endblock %}
